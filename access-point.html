<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Point Performance Monitoring</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#111827',
                            card: '#1f2937',
                            text: '#f3f4f6',
                            border: '#374151'
                        }
                    }
                }
            }
        }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <link rel="stylesheet" href="fontawesome/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/shared-styles.css">
</head>
<body class="bg-gray-100 text-gray-800 h-screen flex flex-col overflow-hidden dark:bg-dark-bg dark:text-dark-text">

    <nav class="bg-white border-b border-gray-200 h-16 flex-none z-10 dark:bg-dark-card dark:border-dark-border">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8 h-full">
            <div class="flex justify-between h-full">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-3">
                        <div class="bg-blue-600 text-white p-2 rounded-lg">
                            <i class="fa-solid fa-network-wired text-xl"></i>
                        </div>
                        <span class="font-bold text-xl tracking-tight text-gray-900 dark:text-white">Network Performance Monitoring</span>
                    </div>
                    <div class="hidden sm:ml-8 sm:flex sm:space-x-8">
                        <a href="index.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Summary Page</a>
                        <a href="sdwan.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">SD-WAN Page</a>
                        <a href="switch.html" class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Switch Page</a>
                        <a href="access-point.html" class="border-blue-500 text-gray-900 dark:text-white inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">Access Point Page</a>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative">
                        <select id="scopeSelector" onchange="updateAccessPointView(this.value)" class="block w-full pl-3 pr-10 py-2 text-sm border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md bg-gray-50 border dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            <option value="NYC-Lobby-AP-01">NYC-Lobby-AP-01</option>
                            <option value="NYC-ConfRoom-AP-04">NYC-ConfRoom-AP-04</option>
                            <option value="LON-Warehouse-AP-12">LON-Warehouse-AP-12</option>
                        </select>
                    </div>

                    <button id="themeToggle" class="p-2 rounded-lg text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 focus:outline-none">
                        <i class="fa-solid fa-moon dark:hidden"></i>
                        <i class="fa-solid fa-sun hidden dark:block text-yellow-400"></i>
                    </button>

                    <div class="flex items-center gap-3 border-l pl-4 border-gray-200 dark:border-gray-700">
                        <div class="text-right hidden md:block">
                            <p class="text-sm font-medium text-gray-900 dark:text-white">Admin User</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">NetOps Lead</p>
                        </div>
                        <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-700 font-bold">
                            AU
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-dark-bg">
        <div class="max-w-[1920px] mx-auto">

            <div class="card p-4 bg-white dark:bg-dark-card border-l-4 border-green-500 mb-0">
                <div class="flex items-center justify-between">
                    <!-- Left: Device Name -->
                    <div class="flex items-center gap-2">
                        <i class="fa-solid fa-wifi text-gray-400 text-lg"></i>
                        <div>
                            <h2 class="text-lg font-bold text-gray-900 dark:text-white">NYC-Lobby-AP-01</h2>
                            <p class="text-xs text-gray-500">Cisco Meraki MR56-HW</p>
                        </div>
                    </div>

                    <!-- Center: IP and MAC -->
                    <div class="flex items-center gap-8 text-sm">
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400">IP:</span>
                            <span class="font-mono text-gray-700 dark:text-gray-300">10.128.20.15</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400">MAC:</span>
                            <span class="font-mono text-gray-700 dark:text-gray-300">e0:cb:bc:45:12:a1</span>
                        </div>
                    </div>

                    <!-- Right: Uptime and Status -->
                    <div class="flex items-center gap-4">
                        <div class="text-right">
                            <p class="text-xs text-gray-400 mb-0.5">Uptime</p>
                            <p class="font-mono text-lg font-bold text-gray-900 dark:text-white">22d 4h 12m</p>
                        </div>
                        <span class="px-2 py-1 text-xs font-bold text-green-700 bg-green-100 rounded dark:bg-green-900 dark:text-green-300">ONLINE</span>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="mb-4 mt-0">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button onclick="switchTab('overview')" id="tab-overview" class="tab-button border-blue-500 text-blue-600 dark:text-blue-400 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            Overview
                        </button>
                        <button onclick="switchTab('diagnostics')" id="tab-diagnostics" class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                            Diagnostics
                        </button>
                    </nav>
                </div>
            </div>

            <div id="content-overview" class="tab-content">
                <div class="grid grid-cols-12 gap-6">
                    
                    <div class="col-span-12 lg:col-span-7 card p-4 bg-white dark:bg-dark-card h-64">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Client Journey Funnel - Success Rate</h3>
                            <button onclick="openFunnelTimeSeries()" class="text-xs text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
                                <i class="fa-solid fa-chart-line"></i> View Time Series
                            </button>
                        </div>
                        <div class="flex items-center justify-around h-full py-0">
                            <!-- Association Gauge -->
                            <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <canvas id="associationGauge"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="top: 12px;">
                                        <span class="text-2xl font-bold text-gray-800 dark:text-white" id="associationValue">--</span>
                                        <span class="text-xs text-gray-400">%</span>
                                    </div>
                                </div>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mt-3">Association</p>
                            </div>

                            <!-- Authentication Gauge -->
                            <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <canvas id="authenticationGauge"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="top: 12px;">
                                        <span class="text-2xl font-bold text-gray-800 dark:text-white" id="authenticationValue">--</span>
                                        <span class="text-xs text-gray-400">%</span>
                                    </div>
                                </div>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mt-3">Authentication</p>
                            </div>

                            <!-- DHCP Gauge -->
                            <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <canvas id="dhcpFunnelGauge"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="top: 12px;">
                                        <span class="text-2xl font-bold text-gray-800 dark:text-white" id="dhcpFunnelValue">--</span>
                                        <span class="text-xs text-gray-400">%</span>
                                    </div>
                                </div>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mt-3">DHCP</p>
                            </div>

                            <!-- DNS Gauge -->
                            <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <canvas id="dnsGauge"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="top: 12px;">
                                        <span class="text-2xl font-bold text-gray-800 dark:text-white" id="dnsValue">--</span>
                                        <span class="text-xs text-gray-400">%</span>
                                    </div>
                                </div>
                                <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mt-3">DNS</p>
                            </div>

                            <!-- Success Gauge -->
                            <div class="flex flex-col items-center">
                                <div class="relative w-32 h-32">
                                    <canvas id="successGauge"></canvas>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none" style="top: 12px;">
                                        <span class="text-2xl font-bold text-gray-800 dark:text-white" id="successValue">--</span>
                                        <span class="text-xs text-gray-400">%</span>
                                    </div>
                                </div>
                                <p class="text-sm font-medium text-green-700 dark:text-green-400 mt-3">Success</p>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-5 card p-4 bg-white dark:bg-dark-card h-64 cursor-pointer hover:shadow-lg transition-shadow" onclick="openClientHistoryOverlay()">
                        <div class="flex justify-between items-center mb-3">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">DHCP Capacity</h3>
                            <button class="text-xs text-blue-600 dark:text-blue-400 hover:underline flex items-center gap-1">
                                <i class="fa-solid fa-chart-line"></i> View History
                            </button>
                        </div>
                        <div class="flex flex-col justify-center" style="height: calc(100% - 2.5rem);">
                            <div class="relative w-full" style="height: 80px; margin-bottom: 1rem;">
                                <canvas id="dhcpCapacityBar"></canvas>
                            </div>
                            <div class="flex justify-around">
                                <div class="text-center">
                                    <div class="flex items-center justify-center gap-1.5">
                                        <span class="w-2.5 h-2.5 bg-blue-500 rounded-sm"></span>
                                        <p class="text-xl font-bold text-gray-800 dark:text-white" id="dhcpUsedValue">--</p>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Used</p>
                                </div>
                                <div class="text-center">
                                    <div class="flex items-center justify-center gap-1.5">
                                        <span class="w-2.5 h-2.5 bg-gray-200 dark:bg-gray-600 rounded-sm"></span>
                                        <p class="text-xl font-bold text-gray-800 dark:text-white" id="dhcpAvailableValue">--</p>
                                    </div>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Available</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-xl font-bold text-gray-800 dark:text-white" id="dhcpPercentageValue">--</p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Utilization</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-4 card p-4 bg-white dark:bg-dark-card h-64">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Top SSIDs</h3>
                            <span class="text-xs text-gray-400">Client Distribution</span>
                        </div>
                         <div class="relative h-full w-full pb-4">
                            <canvas id="ssidChart"></canvas>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-4 card p-4 bg-white dark:bg-dark-card h-64">
                         <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Channel Utilization</h3>
                            <div class="flex gap-3 text-xs">
                                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-blue-500 rounded-sm"></span> WiFi</span>
                                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-red-400 rounded-sm"></span> Non-WiFi</span>
                                <span class="flex items-center gap-1"><span class="w-2 h-2 bg-gray-200 rounded-sm"></span> Free</span>
                            </div>
                        </div>
                        <div class="relative h-full w-full pb-4">
                            <canvas id="channelUtilChart"></canvas>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-4 card p-4 bg-white dark:bg-dark-card h-64">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Signal Quality Distribution (SNR)</h3>
                            <span class="text-xs text-gray-400">Client Density</span>
                        </div>
                        <div class="relative h-full w-full pb-4">
                            <canvas id="snrChart"></canvas>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-8 card p-0 bg-white dark:bg-dark-card flex flex-col h-96">
                        <div class="p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 flex justify-between items-center">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Active Client List</h3>
                            <input type="text" placeholder="Search MAC, IP or User..." class="text-xs border border-gray-300 dark:border-gray-600 rounded px-2 py-1 focus:outline-none focus:border-blue-500 bg-white dark:bg-gray-700 dark:text-white">
                        </div>
                        <div class="flex-1 overflow-auto custom-scrollbar">
                             <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Client MAC</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">IP Address</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">OS</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">SSID</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">SNR</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Usage</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-dark-card divide-y divide-gray-200 dark:divide-gray-700 text-sm font-mono">
                                    <tr>
                                        <td class="px-6 py-3 text-blue-600 dark:text-blue-400 cursor-pointer hover:underline">a4:b1:c2:d3:e4:f5</td>
                                        <td class="px-6 py-3">10.128.20.101</td>
                                        <td class="px-6 py-3"><i class="fa-brands fa-apple"></i> iOS 17</td>
                                        <td class="px-6 py-3">Corp-Secure</td>
                                        <td class="px-6 py-3 text-right text-green-600 font-bold">42 dB</td>
                                        <td class="px-6 py-3 text-right">1.2 GB</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-3 text-blue-600 dark:text-blue-400 cursor-pointer hover:underline">b2:c3:d4:e5:f6:a1</td>
                                        <td class="px-6 py-3">10.128.20.105</td>
                                        <td class="px-6 py-3"><i class="fa-brands fa-windows"></i> Win 11</td>
                                        <td class="px-6 py-3">Corp-Secure</td>
                                        <td class="px-6 py-3 text-right text-green-600 font-bold">38 dB</td>
                                        <td class="px-6 py-3 text-right">450 MB</td>
                                    </tr>
                                     <tr>
                                        <td class="px-6 py-3 text-blue-600 dark:text-blue-400 cursor-pointer hover:underline">c3:d4:e5:f6:a1:b2</td>
                                        <td class="px-6 py-3">10.128.99.20</td>
                                        <td class="px-6 py-3"><i class="fa-brands fa-android"></i> Android</td>
                                        <td class="px-6 py-3">Guest-WiFi</td>
                                        <td class="px-6 py-3 text-right text-amber-500 font-bold">18 dB</td>
                                        <td class="px-6 py-3 text-right">50 MB</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-4 card p-4 bg-white dark:bg-dark-card h-96 flex flex-col">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Recent Client Events</h3>
                            <span class="text-xs text-gray-400">Live Feed</span>
                        </div>
                        <div class="flex-1 overflow-auto custom-scrollbar space-y-3">
                            <div class="flex gap-3 items-start pb-3 border-b border-gray-100 dark:border-gray-700">
                                <div class="w-16 text-xs text-gray-500 dark:text-gray-400 pt-1 flex-shrink-0">10:42:15</div>
                                <div class="w-6 flex flex-col items-center flex-shrink-0">
                                    <div class="w-2 h-2 rounded-full bg-green-500"></div>
                                    <div class="h-full w-0.5 bg-gray-200 dark:bg-gray-700 mt-1"></div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs font-bold text-gray-800 dark:text-white">Association Success</p>
                                    <p class="text-xs text-gray-500">Client <span class="font-mono">a4:b1:c2...</span> associated on 5GHz radio (SSID: Corp-Secure).</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start pb-3 border-b border-gray-100 dark:border-gray-700">
                                <div class="w-16 text-xs text-gray-500 dark:text-gray-400 pt-1 flex-shrink-0">10:41:55</div>
                                <div class="w-6 flex flex-col items-center flex-shrink-0">
                                    <div class="w-2 h-2 rounded-full bg-amber-500"></div>
                                    <div class="h-full w-0.5 bg-gray-200 dark:bg-gray-700 mt-1"></div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs font-bold text-gray-800 dark:text-white">DHCP Slow Response</p>
                                    <p class="text-xs text-gray-500">Client <span class="font-mono">e2:11:98...</span> took 4.2s to receive IP address.</p>
                                </div>
                            </div>
                            <div class="flex gap-3 items-start">
                                <div class="w-16 text-xs text-gray-500 dark:text-gray-400 pt-1 flex-shrink-0">10:38:10</div>
                                <div class="w-6 flex flex-col items-center flex-shrink-0">
                                    <div class="w-2 h-2 rounded-full bg-red-500"></div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <p class="text-xs font-bold text-gray-800 dark:text-white">Auth Failure (4-Way Handshake)</p>
                                    <p class="text-xs text-gray-500">Client <span class="font-mono">b8:22:11...</span> failed WPA2 authentication.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 card p-0 bg-white dark:bg-dark-card flex flex-col h-96">
                        <div class="p-4 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 flex justify-between items-center">
                            <h3 class="text-sm font-bold text-gray-700 dark:text-white">Interfering Neighbors (Rogues/Neighbors)</h3>
                            <span class="text-xs bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 px-2 py-0.5 rounded font-bold">2 High Impact</span>
                        </div>
                        <div class="flex-1 overflow-auto custom-scrollbar">
                             <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                <thead class="bg-gray-50 dark:bg-gray-800 sticky top-0">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">SSID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">BSSID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Channel</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">RSSI</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Classification</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white dark:bg-dark-card divide-y divide-gray-200 dark:divide-gray-700 text-sm font-mono">
                                    <tr class="hover:bg-red-50 dark:hover:bg-red-900/10">
                                        <td class="px-6 py-3 font-bold text-gray-800 dark:text-white">Free_WiFi</td>
                                        <td class="px-6 py-3 text-gray-500">aa:bb:cc:dd:ee:ff</td>
                                        <td class="px-6 py-3">6 (2.4G)</td>
                                        <td class="px-6 py-3 text-red-600 font-bold">-55 dBm</td>
                                        <td class="px-6 py-3"><span class="text-xs bg-red-100 text-red-800 px-2 py-0.5 rounded">ROGUE</span></td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-3 font-bold text-gray-800 dark:text-white">HP-Printer-Direct</td>
                                        <td class="px-6 py-3 text-gray-500">11:22:33:44:55:66</td>
                                        <td class="px-6 py-3">1 (2.4G)</td>
                                        <td class="px-6 py-3 text-amber-600">-68 dBm</td>
                                        <td class="px-6 py-3"><span class="text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded">INTERFERING</span></td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-3 font-bold text-gray-800 dark:text-white">Corp-Guest</td>
                                        <td class="px-6 py-3 text-gray-500">99:88:77:66:55:44</td>
                                        <td class="px-6 py-3">36 (5G)</td>
                                        <td class="px-6 py-3 text-gray-500">-82 dBm</td>
                                        <td class="px-6 py-3"><span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">MANAGED</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>

            <div id="content-diagnostics" class="tab-content hidden">
                <div class="grid grid-cols-12 gap-6">
                    <div class="col-span-12 card p-8 bg-white dark:bg-dark-card text-center">
                        <i class="fa-solid fa-stethoscope text-gray-300 dark:text-gray-600 text-6xl mb-4"></i>
                        <h3 class="text-lg font-bold text-gray-700 dark:text-white mb-2">Diagnostics Tab</h3>
                        <p class="text-gray-500 dark:text-gray-400">Diagnostic tools and utilities will be available here.</p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Funnel Time Series Overlay -->
        <div id="funnelTimeSeriesOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-6">
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-2xl w-full max-w-6xl overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Client Journey Funnel - Time Series Analysis</h2>
                    </div>
                    <button onclick="closeFunnelTimeSeries()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fa-solid fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="card p-4 bg-gray-50 dark:bg-gray-800">
                        <h3 class="text-sm font-bold text-gray-700 dark:text-white mb-3">Funnel Stage Completion Over Time (Last 24 Hours)</h3>
                        <div style="height: 400px;">
                            <canvas id="funnelTimeSeriesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Client Count History Overlay -->
        <div id="clientHistoryOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-6">
            <div class="bg-white dark:bg-dark-card rounded-lg shadow-2xl w-full max-w-6xl overflow-hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Client Count History</h2>
                    </div>
                    <button onclick="closeClientHistoryOverlay()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fa-solid fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div class="card p-4 bg-gray-50 dark:bg-gray-800">
                        <h3 class="text-sm font-bold text-gray-700 dark:text-white mb-3">Connected Clients Over Time (Last 24 Hours)</h3>
                        <div style="height: 400px;">
                            <canvas id="clientHistoryOverlayChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="mt-8 mb-4 text-center text-xs text-gray-400 dark:text-gray-500">
            <p>NPM 2.0 Operational Command Center</p>
        </footer>
    </main>

    <script src="assets/js/theme-manager.js"></script>
    <script src="assets/js/chart-config.js"></script>
    <script src="assets/js/navigation.js"></script>

    <script>
        // Initialize navigation for AP page
        NavigationManager.init('ap');

        // --- ACCESS POINT SELECTOR ---
        function updateAccessPointView(apName) {
            console.log('Access point view changed to:', apName);
            // Update the device info card header
            document.querySelector('h2.text-lg.font-bold').textContent = apName;

            // In a real application, this would reload the data for the selected access point
            // For now, it just logs the change
        }

        // --- TAB SWITCHING LOGIC ---
        function switchTab(tabName) {
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.add('hidden'));

            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
                button.classList.add('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            });

            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            const selectedButton = document.getElementById(`tab-${tabName}`);
            selectedButton.classList.remove('border-transparent', 'text-gray-500', 'dark:text-gray-400');
            selectedButton.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400');
        }

        // --- CHART INITIALIZATION ---
        const charts = {};

        function initCharts() {
            ChartConfig.initDefaults();

            // Unregister datalabels plugin globally (we'll enable it per chart)
            Chart.unregister(ChartDataLabels);

            // 1. Client Journey Funnel - Dial Gauges
            // Generate random percentages with mean 95% and std dev 2% (using Box-Muller transform)
            function generateRandomPercentage(mean = 95, stdDev = 2) {
                // Box-Muller transform for normal distribution
                const u1 = Math.random();
                const u2 = Math.random();
                const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                const value = mean + z0 * stdDev;
                // Cap at 100%
                return Math.min(100, value);
            }

            // Generate percentages for each stage
            const funnelData = {
                association: generateRandomPercentage(), // Random ~95%
                authentication: generateRandomPercentage(), // Random ~95%
                dhcp: generateRandomPercentage(), // Random ~95%
                dns: generateRandomPercentage(), // Random ~95%
                success: 0 // Will be calculated as product
            };

            // Success is the product of all stages
            funnelData.success = (funnelData.association / 100) *
                                  (funnelData.authentication / 100) *
                                  (funnelData.dhcp / 100) *
                                  (funnelData.dns / 100) * 100;

            // Helper function to create gauge chart (full circle like DHCP Capacity)
            function createGauge(canvasId, value, color) {
                return new Chart(document.getElementById(canvasId), {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [value, 100 - value],
                            backgroundColor: [color, '#e5e7eb'],
                            borderWidth: 0,
                            cutout: '75%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            tooltip: { enabled: false },
                            legend: { display: false }
                        }
                    }
                });
            }

            // Association Gauge
            charts.associationGauge = createGauge('associationGauge', funnelData.association, '#3b82f6');
            document.getElementById('associationValue').textContent = funnelData.association.toFixed(1);

            // Authentication Gauge
            charts.authenticationGauge = createGauge('authenticationGauge', funnelData.authentication, '#6366f1');
            document.getElementById('authenticationValue').textContent = funnelData.authentication.toFixed(1);

            // DHCP Gauge
            charts.dhcpFunnelGauge = createGauge('dhcpFunnelGauge', funnelData.dhcp, '#f59e0b');
            document.getElementById('dhcpFunnelValue').textContent = funnelData.dhcp.toFixed(1);

            // DNS Gauge
            charts.dnsGauge = createGauge('dnsGauge', funnelData.dns, '#8b5cf6');
            document.getElementById('dnsValue').textContent = funnelData.dns.toFixed(1);

            // Success Gauge (product of all stages)
            charts.successGauge = createGauge('successGauge', funnelData.success, '#10b981');
            document.getElementById('successValue').textContent = funnelData.success.toFixed(1);

            // 2. DHCP Capacity - Horizontal Stacked Bar
            const dhcpUsed = 182;
            const dhcpTotal = 254;
            const dhcpAvailable = dhcpTotal - dhcpUsed;
            const dhcpPercentage = (dhcpUsed / dhcpTotal * 100).toFixed(1);

            charts.dhcpCapacity = new Chart(document.getElementById('dhcpCapacityBar'), {
                type: 'bar',
                data: {
                    labels: ['DHCP Pool'],
                    datasets: [
                        {
                            label: 'Used',
                            data: [dhcpUsed],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4
                        },
                        {
                            label: 'Available',
                            data: [dhcpAvailable],
                            backgroundColor: '#e5e7eb',
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.parsed.x;
                                    const percentage = ((value / dhcpTotal) * 100).toFixed(1);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            max: dhcpTotal,
                            grid: { display: false },
                            ticks: { display: false }
                        },
                        y: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { display: false }
                        }
                    }
                }
            });

            document.getElementById('dhcpUsedValue').textContent = dhcpUsed;
            document.getElementById('dhcpAvailableValue').textContent = dhcpAvailable;
            document.getElementById('dhcpPercentageValue').textContent = dhcpPercentage + '%';

            // 3. Channel Utilization [cite: 157]
            // Stacked Bar for 2.4/5/6 GHz
            charts.channel = new Chart(document.getElementById('channelUtilChart'), {
                type: 'bar',
                data: {
                    labels: ['2.4 GHz', '5 GHz', '6 GHz'],
                    datasets: [
                        { label: 'WiFi Traffic', data: [45, 20, 5], backgroundColor: '#3b82f6' },
                        { label: 'Interference', data: [15, 5, 0], backgroundColor: '#f87171' },
                        { label: 'Free Airtime', data: [40, 75, 95], backgroundColor: '#e5e7eb' }
                    ]
                },
                options: {
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, max: 100, ticks: { callback: v => v + '%' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            // 4. SNR Distribution
            charts.snr = new Chart(document.getElementById('snrChart'), {
                type: 'bar',
                data: {
                    labels: ['Poor (<15dB)', 'Fair (15-25dB)', 'Good (25-35dB)', 'Excellent (>35dB)'],
                    datasets: [{
                        label: 'Client Count',
                        data: [2, 5, 18, 17],
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'],
                        borderRadius: 4
                    }]
                },
                options: {
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                }
            });

             // 5. Top SSIDs
             charts.ssids = new Chart(document.getElementById('ssidChart'), {
                type: 'bar',
                data: {
                    labels: ['Corp-Secure', 'Guest-WiFi', 'IoT-Devices', 'Legacy-App'],
                    datasets: [{
                        label: 'Clients',
                        data: [28, 8, 4, 2],
                        backgroundColor: '#6366f1',
                        borderRadius: 4,
                        barThickness: 20
                    }]
                },
                options: {
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: {
                        x: {
                            display: true,
                            grid: { display: true, color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { font: { size: 10 } }
                        },
                        y: { grid: { display: false } }
                    }
                }
            });
        }

        // Initialize Everything
        initCharts();

        // Register charts for theme switching
        themeManager.registerCharts(charts);

        // Initial theme check
        if (themeManager.isDarkMode()) {
            themeManager.updateChartColors();
        }

        // --- FUNNEL TIME SERIES OVERLAY ---
        let funnelTimeSeriesChart = null;

        function openFunnelTimeSeries() {
            const overlay = document.getElementById('funnelTimeSeriesOverlay');
            overlay.classList.remove('hidden');

            // Destroy existing chart if it exists
            if (funnelTimeSeriesChart) {
                funnelTimeSeriesChart.destroy();
            }

            // Sample time series data - in a real app, this would come from an API
            const timeLabels = ['00:00', '02:00', '04:00', '06:00', '08:00', '10:00', '12:00', '14:00', '16:00', '18:00', '20:00', '22:00', 'Now'];

            // Helper function to generate random percentage with normal distribution
            function generateRandomPercentageTS(mean = 95, stdDev = 2) {
                const u1 = Math.random();
                const u2 = Math.random();
                const z0 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                const value = mean + z0 * stdDev;
                return Math.min(100, value);
            }

            // Generate random percentages for time series (mean 95%, std dev 2%)
            const percentageData = {
                association: timeLabels.map(() => parseFloat(generateRandomPercentageTS().toFixed(2))),
                authentication: timeLabels.map(() => parseFloat(generateRandomPercentageTS().toFixed(2))),
                dhcp: timeLabels.map(() => parseFloat(generateRandomPercentageTS().toFixed(2))),
                dns: timeLabels.map(() => parseFloat(generateRandomPercentageTS().toFixed(2))),
                success: [] // Will be calculated as product
            };

            // Calculate success as product of all stages
            percentageData.success = timeLabels.map((_, idx) => {
                const product = (percentageData.association[idx] / 100) *
                               (percentageData.authentication[idx] / 100) *
                               (percentageData.dhcp[idx] / 100) *
                               (percentageData.dns[idx] / 100) * 100;
                return parseFloat(product.toFixed(2));
            });

            // Generate corresponding raw client counts for tooltips
            const baseClients = 1200;
            const rawData = {
                association: percentageData.association.map(() => baseClients),
                authentication: percentageData.authentication.map((pct) => Math.round(baseClients * pct / 100)),
                dhcp: percentageData.dhcp.map((pct, idx) => Math.round(percentageData.authentication[idx] * baseClients / 100)),
                dns: percentageData.dns.map((pct, idx) => Math.round(percentageData.dhcp[idx] * percentageData.authentication[idx] * baseClients / 10000)),
                success: percentageData.success.map((pct) => Math.round(baseClients * pct / 100))
            };

            // Find the minimum value across all datasets
            const allValues = [
                ...percentageData.association,
                ...percentageData.authentication,
                ...percentageData.dhcp,
                ...percentageData.dns,
                ...percentageData.success
            ];
            const minValue = Math.min(...allValues);
            const yAxisMin = Math.max(0, minValue - 5); // 5% below the lowest value, but not below 0

            // Create time series chart
            funnelTimeSeriesChart = new Chart(document.getElementById('funnelTimeSeriesChart'), {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [
                        {
                            label: 'Association',
                            data: percentageData.association,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            rawData: rawData.association
                        },
                        {
                            label: 'Authentication',
                            data: percentageData.authentication,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            rawData: rawData.authentication
                        },
                        {
                            label: 'DHCP',
                            data: percentageData.dhcp,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            rawData: rawData.dhcp
                        },
                        {
                            label: 'DNS',
                            data: percentageData.dns,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            rawData: rawData.dns
                        },
                        {
                            label: 'Success',
                            data: percentageData.success,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6,
                            borderWidth: 3,
                            rawData: rawData.success
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                boxWidth: 12,
                                font: { size: 12 },
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    const percentage = context.parsed.y;
                                    const absoluteValue = context.dataset.rawData[context.dataIndex];
                                    label += percentage + '% (' + absoluteValue + ' clients)';
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: { display: true, color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: {
                                font: { size: 11 }
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: false,
                            min: yAxisMin,
                            max: 101,
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    }
                },
                plugins: [ChartDataLabels] // Disable datalabels for this chart
            });

            // Disable datalabels plugin for this specific chart
            funnelTimeSeriesChart.options.plugins.datalabels = { display: false };
            funnelTimeSeriesChart.update();
        }

        function closeFunnelTimeSeries() {
            const overlay = document.getElementById('funnelTimeSeriesOverlay');
            overlay.classList.add('hidden');

            // Destroy chart to prevent memory leaks
            if (funnelTimeSeriesChart) {
                funnelTimeSeriesChart.destroy();
                funnelTimeSeriesChart = null;
            }
        }

        // --- CLIENT COUNT HISTORY OVERLAY ---
        let clientHistoryOverlayChart = null;

        function openClientHistoryOverlay() {
            const overlay = document.getElementById('clientHistoryOverlay');
            overlay.classList.remove('hidden');

            // Destroy existing chart if it exists
            if (clientHistoryOverlayChart) {
                clientHistoryOverlayChart.destroy();
            }

            // Generate time labels for 24 hours
            const timeLabels = [];
            for (let i = 0; i <= 24; i++) {
                const hour = i % 24;
                timeLabels.push(i === 24 ? 'Now' : `${hour.toString().padStart(2, '0')}:00`);
            }

            // Generate realistic client count data with variation throughout the day
            const clientData = timeLabels.map((label, idx) => {
                const hour = idx;
                // Night hours (0-6): low activity (5-15 clients)
                if (hour >= 0 && hour < 6) return Math.floor(Math.random() * 10) + 5;
                // Morning ramp up (6-9): increasing (15-35 clients)
                if (hour >= 6 && hour < 9) return Math.floor(Math.random() * 20) + 15;
                // Work hours (9-17): high activity (35-50 clients)
                if (hour >= 9 && hour < 17) return Math.floor(Math.random() * 15) + 35;
                // Evening decline (17-22): decreasing (15-35 clients)
                if (hour >= 17 && hour < 22) return Math.floor(Math.random() * 20) + 15;
                // Late night (22-24): low activity (5-15 clients)
                return Math.floor(Math.random() * 10) + 5;
            });

            // Create time series chart
            clientHistoryOverlayChart = new Chart(document.getElementById('clientHistoryOverlayChart'), {
                type: 'line',
                data: {
                    labels: timeLabels,
                    datasets: [{
                        label: 'Connected Clients',
                        data: clientData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 3,
                        pointHoverRadius: 6,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#3b82f6',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return 'Clients: ' + context.parsed.y;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: { display: true, color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: {
                                font: { size: 11 },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            ticks: {
                                font: { size: 11 },
                                callback: function(value) {
                                    return value;
                                }
                            },
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        }
                    }
                }
            });

            // Disable datalabels plugin for this specific chart
            if (clientHistoryOverlayChart.options.plugins) {
                clientHistoryOverlayChart.options.plugins.datalabels = { display: false };
            }
            clientHistoryOverlayChart.update();
        }

        function closeClientHistoryOverlay() {
            const overlay = document.getElementById('clientHistoryOverlay');
            overlay.classList.add('hidden');

            // Destroy chart to prevent memory leaks
            if (clientHistoryOverlayChart) {
                clientHistoryOverlayChart.destroy();
                clientHistoryOverlayChart = null;
            }
        }

    </script>
</body>
</html>